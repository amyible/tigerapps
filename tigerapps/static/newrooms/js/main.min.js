/* global overlay_control */
function setHover(e){this.openPopup()
var o=e.target
o.setStyle({weight:5,color:"#666",dashArray:"",fillOpacity:.7})}function removeHover(e){map.closePopup(),layers.footprints.resetStyle(e.target)}function setMapView(e){if(null==e)map.hasLayer(layers.floorplan)&&map.removeLayer(layers.floorplan),map.addLayer(layers.tiles).addLayer(layers.footprints),map.setMaxZoom(18).setMinZoom(16),map.setMaxBounds([[40.33761,-74.66769],[40.350697,-74.65053]]),map.setView(mapPos.center,mapPos.zoom,{reset:!0}),map.setZoom(mapPos.zoom,{animate:!1}),mapPos=null,map.addControl(legend_control),overlay_control&&map.removeControl(overlay_control),$(".searchbox").show(),$("#searchbox").val("").focus()
else{$(".searchbox").hide(),map.removeControl(legend_control)
for(var o=["0030-A","0092-A","0636-00","0636-01","0636-02","0636-03","0636-04","0668-00","0668-01","0668-A","0686-04"],t=document.getElementById("map"),a={width:t.clientWidth,height:t.clientHeight},r={width:3400,height:2200},i=0;i<o.length;i++)e==o[i]&&(r={height:3400,width:2200})
var s
s=a.width/r.width>a.height/r.height?{width:r.width/r.height*a.height,height:a.height}:{width:a.width,height:r.height/r.width*a.width}
var n=s.width,l=s.height,p="/static/newrooms/svgz/"+e+".svgz"+cache_bust,m=map.unproject([0,l],16),h=map.unproject([n,0],16),d=new L.LatLngBounds(m,h)
map.removeLayer(layers.tiles).removeLayer(layers.footprints),map.hasLayer(layers.floorplan)&&map.removeLayer(layers.floorplan),layers.floorplan=L.imageOverlay(p,d),map.addLayer(layers.floorplan),null==mapPos&&(mapPos={center:map.getCenter(),zoom:map.getZoom()},map.setMaxBounds(d),map.setMinZoom(16).setMaxZoom(18),map.setView(map.unproject([n/2,l/2],16),16,{reset:!0}),map.setZoom(16)),overlay_control&&map.removeControl(overlay_control)
var c=e.split("-")[0],g=e.split("-")[1]
overlay_control=new OverlayControl({building_id:c,floor_id:g}),map.addControl(overlay_control)}}map=L.map("map",{scrollWheelZoom:!1}),layers={},layers.tiles=L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy <a href="http://mapbox.com">Mapbox</a>, Rooms app by Ben Parks \'17',id:"mapbox.streets-basic",accessToken:"pk.eyJ1IjoiYm5wcmtzIiwiYSI6ImNpbGNoemFubjJ4c2d0dWx4MDVvbHpmczcifQ.Lm1VY5wMBGN-cGzMZ2gYqA"}),layers.footprints=L.geoJson(footprints,{style:function(e){var o={butler:"#0068AC",whitman:"#89CCE2",rockefeller:"#6EB43F",mathey:"#941e00",forbes:"#EF4035",wilson:"#F8981D",upperclass:"#828282"},t=buildings[e.properties.id].college.sort(),a=o[t[0]]
return t.length>1&&(a="url(#"+t.join("-")+")"),{fillColor:a,weight:2,opacity:1,color:"white",dashArray:"3",fillOpacity:.7}},onEachFeature:function(e,o){var t=buildings[e.properties.id]
o.bindPopup("<strong>"+t.name+"</strong><br/>Click to view floorplans",{closeButton:!1,autoPan:!1}),o.on({mouseover:setHover.bind(o),mouseout:removeHover.bind(o),popupopen:function(e){var t=o.getBounds(),a=t.getNorth(),r=t.getCenter().lng
e.popup.setLatLng([a,r])},click:function(e){layers.footprints.resetStyle(e.target),setMapView(t.id+"-"+t.floors[0])}})}}),overlay_control=null,legend_control=new LegendControl,mapPos={center:[40.345129502014764,-74.65826869010927],zoom:17},setMapView()
var hash=window.location.hash.slice(1)
if(hash){var building_id=hash.split("-")[0],floor_id=hash.split("-")[1]
buildings[building_id]&&-1!=buildings[building_id].floors.indexOf(floor_id)&&setMapView(hash)}var substringMatcher=function(e){return function(e,o){var t
t=[],substrRegex=new RegExp(e,"i")
for(var a in dorms)substrRegex.test(a)&&t.push(a)
o(t)}},dorms={}
for(var i in buildings)dorms[buildings[i].name]=i
$("#searchbox").typeahead({hint:!0,highlight:!0,minLength:1},{name:"dorms",source:substringMatcher(dorms)}),$("#searchbox").bind("typeahead:select input",function(){void 0!==dorms[this.value]&&(building=buildings[dorms[this.value]],setMapView(building.id+"-"+building.floors[0]))})
